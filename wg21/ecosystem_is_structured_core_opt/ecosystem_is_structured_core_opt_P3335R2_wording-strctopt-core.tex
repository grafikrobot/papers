%!TEX root = ecosystem.tex

% Copyright 2024 Ren√© Ferdinand Rivera Morell
% Creative Commons Attribution 4.0 International License (CC BY 4.0)

% Structured Core Options
\rSec0[strctopt.core]{Structured Core Options}

% Preamble
\rSec1[strctopt.core.pre]{Preamble}

\pnum
This clause describes the schema and semantics of core structured options
\iref{strctopt.schema.struct} for C++ compiler front-end applications.

\pnum
This clause specifies the \verb{std.strctopt.core} capability
\iref{intspct.cap} version \verb{1.0.0}.

\pnum
An application can implement this capability.

\pnum
An application that implements the \verb{std.strctopt.core} capability shall include
the \verb{std.strctopt.core} field and version value in the introspection JSON
text output \iref{intspct.schema.cap}.

% Source
\rSec1[strctopt.core.src]{Source}


\begin{itemdescr}
\pnum \fldname \verb{std.source} or \verb{source}
\pnum \fldtype \verb{array}
\pnum \fldval The value shall be a JSON \verb{array}. The items in the \verb{array}
  shall be of JSON \verb{object} items specifying source objects
  \iref{strctopt.core.srcobj}.
\pnum \flddesc
  Defines a list of source files for an application to process.
\end{itemdescr}

\pnum
The application shall add the given sources to the set of files to process.

\pnum
The sources given shall be appended to existing sources in the order given.

% Source Object
\rSec2[strctopt.core.srcobj]{Source Object}

\pnum
A source object shall have a \verb{name} field.


\begin{itemdescr}
\pnum \fldname \verb{std.name} or \verb{name}
\pnum \fldtype \verb{string}
\pnum \fldval A pathname to a file.
\pnum \flddesc The pathname of the source file.
\end{itemdescr}

\pnum
A source object can have a language field
\iref{strctopt.core.lang}.

\pnum
Specifying a language field for a source shall replace any other
determination of the source language by the application.

\pnum
Specifying a language field for a source shall replace a language field
specified in the structured parameters options field
\iref{strctparam.schema.opts}.

\pnum
A source object can have a kind field
\iref{strctopt.core.kind}.

\pnum
Specifying a kind field for a source shall replace any other
determination of the source kind by the application.

\pnum
Specifying a kind field for a source shall replace a kind field
specified in the structured parameters options field
\iref{strctparam.schema.opts}.

\pnum
A source object can have a vendor field
\iref{strctopt.core.vendor}.

% Output
\rSec1[strctopt.core.out]{Output}


\begin{itemdescr}
\pnum \fldname \verb{std.output} or \verb{output}
\pnum \fldtype \verb{array}
\pnum \fldval The value shall be a JSON \verb{array}. The items in the \verb{array}
  shall be JSON \verb{object} items specifying output objects
  \iref{strctopt-core-outobj}.
\pnum \flddesc
  Specifies the output files to generated when processing sources
  \iref{strctopt.core.src}.
\end{itemdescr}

% Output Object
\rSec2[strctopt.core.outobj]{Output Object}

\pnum
An output object shall have a \verb{name} field.


\begin{itemdescr}
\pnum \fldname \verb{std.name} or \verb{name}
\pnum \fldtype \verb{string}
\pnum \fldval A pathname to a file.
\pnum \flddesc The name of the output file.
\end{itemdescr}

\pnum
An output object can have a kind field
\iref{strctopt.core.kind}.

\pnum
Specifying a kind field for output shall replace any other
determination of the output kind by the application.

\pnum
An output object can have a vendor field
\iref{strctopt.core.vendor}.

% Include Directories
\rSec1[strctopt.core.incd]{Include Directories}


\begin{itemdescr}
\pnum \fldname \verb{std.include_dirs} or \verb{include_dirs}
\pnum \fldtype \verb{array}
\pnum \fldval The value shall be a JSON \verb{array}. The items in the \verb{array}
  shall be JSON \verb{string} items of pathnames to directories.
\pnum \flddesc
  One or more entries to directories that are searched by the header inclusion
  of a C++ preprocessor.
\end{itemdescr}

\pnum
The application shall add the given directories to the set of directories
searched by the header inclusion of a C++ preprocessor.

\pnum
The directories given shall be appended to the existing include search
directories in the order given.

% Library Directories
\rSec1[strctopt.core.libd]{Library Directories}


\begin{itemdescr}
\pnum \fldname \verb{std.library_dirs} or \verb{library_dirs}
\pnum \fldtype \verb{array}
\pnum \fldval The value shall be a JSON \verb{array}. The items in the \verb{array}
  shall be JSON \verb{string} items of pathnames to directories.
\pnum \flddesc
  One or more entries to directories that are searched for libraries.
\end{itemdescr}

\pnum
The application shall add the given directories to the set of directories
searched for libraries.

\pnum
The directories given shall be appended to the existing library search
directories in the order given.

% Define Preprocessor Symbols
\rSec1[strctopt.core.def]{Define Preprocessor Symbols}


\begin{itemdescr}
\pnum \fldname \verb{std.define} or \verb{define}
\pnum \fldtype \verb{array}
\pnum \fldval The value shall be a JSON \verb{array}. The items in the \verb{array}
  shall be JSON \verb{object} items specifying preprocessor symbol definition
  objects \iref{strctopt.core.def.sym}.
\pnum \flddesc
  Specifies preprocessor symbols to define during processing of sources.
\end{itemdescr}

% Preprocessor Symbol Definition Object
\rSec2[strctopt.core.def.sym]{Preprocessor Symbol Definition Object}


\begin{itemdescr}
\pnum \fldname \verb{std.name} or \verb{name}
\pnum \fldtype \verb{string}
\pnum \fldval A valid preprocessor symbol.
\pnum \flddesc
  The field specifies the preprocessor symbol to define.
\end{itemdescr}

\pnum
The symbol shall be valid for the consuming application.

\pnum
The application shall indicate an error for invalid symbols.


\begin{itemdescr}
\pnum \fldname \verb{std.value} or \verb{value}
\pnum \fldtype \verb{number}, \verb{string}, \verb{boolean}, or \verb{null}
\pnum \fldval A valid preprocessor define value.
\pnum \flddesc
  The field specifies the value to assign to the preprocessor symbol.
\end{itemdescr}

\pnum
The value shall be valid for the consuming application.

\pnum
A \verb{number} value shall be converted to a string value.

\pnum
A `string`value shall be used as given.

\pnum
A \verb{true} value shall be converted to a string value of \verb{1}.

\pnum
A \verb{false} value shall be converted to a string value of \verb{0}.

\pnum
A \verb{null} value shall not convert and the application default value will be used.

% Undefine Preprocessor Symbols
\rSec1[strctopt.core.undef]{Undefine Preprocessor Symbols}


\begin{itemdescr}
\pnum \fldname \verb{std.undef} or \verb{undef}
\pnum \fldtype \verb{array}
\pnum \fldval The value shall be a JSON \verb{array}. The items in the \verb{array}
  shall be of JSON \verb{string} defining preprocessor symbol names.
\pnum \flddesc Specifies preprocessor symbols to "undefine".
\end{itemdescr}

\pnum
The symbols shall be valid for the consuming application.

\pnum
The application shall indicate an error for invalid symbols.

\pnum
The application shall evaluate this option after any \verb{std.define}
\iref{strctopt.core.def} options.

% Optimization
\rSec1[strctopt.core.opt]{Optimization}


\begin{itemdescr}
\pnum \fldname \verb{std.optimization} or \verb{optimization}
\pnum \fldtype \verb{string}
\pnum \fldval An optimization object item
  \iref{strctopt-core-optobj}
\pnum \flddesc The optimization to apply when generating the output.
\end{itemdescr}

\pnum
The application shall replace each existing field in the optimization object
\iref{strctopt-core-optobj}.

% Optimization Object
\rSec2[strctopt.core.optobj]{Optimization Object}

\pnum
An optimization object can have any of \verb{compile} and \verb{link} fields.


\begin{itemdescr}
\pnum \fldname \verb{compile}
\pnum \fldtype \verb{string}
\pnum \fldval \verb{off}, \verb{minimal}, \verb{speed}, \verb{space}, or \verb{debug}
\pnum \flddesc
  The amount or type of optimization to apply to the generated output.
\end{itemdescr}

\pnum
An application shall not perform optimization when given the \verb{off} value.

\pnum
For \verb{minimal},\verb{speed}, \verb{space}, and \verb{debug} values the application behavior is
unspecified.


\begin{itemdescr}
\pnum \fldname \verb{link}
\pnum \fldtype \verb{boolean}
\pnum \fldval \verb{true} or \verb{false}
\pnum \flddesc
  Specify if optimizations that happen for linked output generation happen.
\end{itemdescr}

\pnum
An application shall not perform optimizations for linked output generation
when the value is \verb{false}.

\pnum
For a \verb{true} value the application behavior is unspecified.

\pnum
An optimization object can have a vendor field
\iref{strctopt.core.vendor}.

% Vendor
\rSec1[strctopt.core.vendor]{Vendor}


\begin{itemdescr}
\pnum \fldname \verb{std.vendor} or \verb{vendor}
\pnum \fldtype \verb{object}
\pnum \fldval A vendor object
  \iref{strctopt.core.vendorobj}
\pnum \flddesc
  Specifies vendor defined options to apply in the context they appear.
\end{itemdescr}

\pnum
An application shall apply the vendor option semantics in the context they
appear.

% Vendor Object
\rSec2[strctopt.core.vendorobj]{Vendor Object}

\pnum
A vendor object can have any number of fields.

\pnum
The name of a field is unspecified.

\pnum
The value of a field is unspecified.

\begin{note}
It is up to application vendors to agree on the name fields.
\end{note}

\begin{note}
It is up to application vendors to document the schema of the field
values.
\end{note}

% Language
\rSec1[strctopt.core.lang]{Language}


\begin{itemdescr}
\pnum \fldname \verb{language}
\pnum \fldtype \verb{object}
\pnum \fldval A language object
  \iref{strctop.core.langobj}
\pnum \flddesc The language to interpret the source as.
\end{itemdescr}

% Language Object
\rSec2[strctopt.core.langobj]{Language Object}

\pnum
A language object shall have a \verb{name} field.


\begin{itemdescr}
\pnum \fldname \verb{std.name} or \verb{name}
\pnum \fldtype \verb{string}
\pnum \fldval One of: \verb{c++} or an application defined value.
\pnum \flddesc Specifies the source text language.
\end{itemdescr}

\pnum
Only a value of \verb{c++} specifies that source text
\iref{strctopt.core.src} is C++ ISO language.

% Kind
\rSec1[strctopt.core.kind]{Kind}


\begin{itemdescr}
\pnum \fldname \verb{kind}
\pnum \fldtype \verb{string}
\pnum \fldval A kind item \iref{strctopt.core.kind}
\pnum \flddesc
  The kind, or format, of the source file corresponding to the output
  file \iref{strctopt.core.out}.
\end{itemdescr}

% Kind Object
\rSec2[strctopt.core.kindobj]{Kind Object}


\begin{itemdescr}
\pnum \fldname \verb{std.name} or \verb{name}
\pnum \fldtype \verb{string}
\pnum \fldval One of: \verb{text}, \verb{exec}, \verb{object}, \verb{dynamic_lib},
  \verb{archive_lib}
\pnum \flddesc The kind, or format, of source and output files.
\end{itemdescr}

\pnum
A \verb{text} value specifies that the source or output is textual.

\pnum
A \verb{exec} value specifies that the source or output is an executable program.

\pnum
A \verb{object} value specifies that the source or output is a linkable object.

\pnum
A \verb{dynamic_lib} value specifies that the source or output is dynamically
linkable.

\pnum
A \verb{archive_lib} value specifies that the source or output is an archive, or
collection, of linkable objects.
